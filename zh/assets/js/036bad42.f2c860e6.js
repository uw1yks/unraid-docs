"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5078],{2444:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var t=s(5893),r=s(1151);const i={},o="Setup Sleep (S3) and Wake on Lan (WOL)",l={id:"legacy/FAQ/setup-sleep-and-wake-on-lan",title:"Setup Sleep (S3) and Wake on Lan (WOL)",description:"The following are my notes for setting up my Unraid server to sleep to",source:"@site/docs/legacy/FAQ/setup-sleep-and-wake-on-lan.md",sourceDirName:"legacy/FAQ",slug:"/legacy/FAQ/setup-sleep-and-wake-on-lan",permalink:"/zh/legacy/FAQ/setup-sleep-and-wake-on-lan",draft:!1,unlisted:!1,editUrl:"https://github.com/unraid/docs/tree/main/docs/legacy/FAQ/setup-sleep-and-wake-on-lan.md",tags:[],version:"current",frontMatter:{},sidebar:"unraidSidebar",previous:{title:"Setting Up CPU and Board Temperature Sensing",permalink:"/zh/legacy/FAQ/setting-up-cpu-and-board-temperature-sensing"},next:{title:"Shrink Array",permalink:"/zh/legacy/FAQ/shrink-array"}},a={},d=[];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"setup-sleep-s3-and-wake-on-lan-wol",children:"Setup Sleep (S3) and Wake on Lan (WOL)"}),"\n",(0,t.jsx)(n.p,{children:"The following are my notes for setting up my Unraid server to sleep to\nS3 state and then wake up to Magic Packet. This is a 'For Beginners, By\nBeginners' effort - there's very little original work here. I just\ntried to piece together whatever I needed from various threads on the\nUnraid forums. My server uses a Foxconn A7GM-S AMD 780G/SB700 based\nmotherboard, and I am running Unraid 4.4.2. In general, I think the\nbelow is procedurally correct - although different motherboards will\nhave different capabilities and driver concerns. Also - all computers\nwith access to my Unraid server are Windows machines, I do not know how\nany of this would change if accessing from a machine with a different\nOS. The following assumes the use of a Windows machine."}),"\n",(0,t.jsx)(n.p,{children:"1. BIOS settings for S1 / S3 sleep state"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Review BIOS settings on Unraid server for allowable sleep states."}),"\n",(0,t.jsx)(n.li,{children:'On my motherboard, the setting is "ACPI Suspend Type" and provides\noption to either suspend to S1 or S3 sleep state. Select S3.'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"2. BIOS settings for WOL"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Review BIOS settings on Unraid server for "Resume by" options.'}),"\n",(0,t.jsx)(n.li,{children:'My motherboard has a setting for "Resume by LAN". It can be enabled\nor disabled. You need to enable "Resume by LAN".'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"3. Double check NIC WOL settings"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Boot Unraid server."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Use the Terminal on the WebUI (present in v6, one of the buttons in\nthe upper right corner, or fall-back to ",(0,t.jsx)(n.a,{href:"/zh/legacy/FAQ/terminal-access",children:"SSH or Telnet"})," and type ",(0,t.jsx)(n.code,{children:"ethtool eth0"})," from the command line"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"You're looking to confirm that the setting for \"Wake-on\" includes\n'g' . . . which is the option for allowing Wake on Magic Packet.\nWe're essentially confirming the BIOS settings from Step 2 above."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The results of my ",(0,t.jsx)(n.strong,{children:"ethtool eth0"})," command are as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@Tower:~# ethtool eth0\nSettings for eth0:\nSupported ports: [ TP MII ]\nSupported link modes:   10baseT/Half 10baseT/Full\n                        100baseT/Half 100baseT/Full\n                        1000baseT/Half 1000baseT/Full\nSupports auto-negotiation: Yes\nAdvertised link modes:  10baseT/Half 10baseT/Full\n                        100baseT/Half 100baseT/Full\n                        1000baseT/Half 1000baseT/Full\nAdvertised auto-negotiation: Yes\nSpeed: 1000Mb/s\nDuplex: Full\nPort: MII\nPHYAD: 0\nTransceiver: internal\nAuto-negotiation: on\nSupports Wake-on: pumbg\nWake-on: g\nCurrent message level: 0x00000033 (51)\nLink detected: yes\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"If the wake-on setting does not include 'g', you can set it\nmanually by typing the following at the server command line:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"ethtool -s eth0 wol g\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"If necessary, you can add the above line to your 'go' script, but\nI've not had a problem with my machine keeping the setting once it\nis set and the appropriate Wake on LAN setting is enabled in BIOS."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["4. Download ",(0,t.jsx)(n.strong,{children:"wolcmd"})," executable"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.a,{href:"http://www.depicus.com/wake-on-lan/wake-on-lan-cmd.aspx",children:"Depicus 'Wake on\nLan'"}),"\npage, select ",(0,t.jsx)(n.strong,{children:"Download"})," button near the bottom"]}),"\n",(0,t.jsxs)(n.li,{children:["I placed the file in ",(0,t.jsx)(n.em,{children:"C:\\Program Files\\WOLcmd"})," (location becomes\nimportant in next step)"]}),"\n",(0,t.jsx)(n.li,{children:"There are other Magic Packet tools available, this is just one that\nI found simple to deal with."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["5. Generate ",(0,t.jsx)(n.strong,{children:"Wakeup.bat"})," batch file (or download mine from\n",(0,t.jsx)(n.a,{href:"https://forums.unraid.net/forum/index.php?topic=3657.msg39076#msg39076",children:"here"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"My batch file is simply two lines"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Change folder directory as necessary depending on where you\nsaved wolcmd.exe."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Enter the MAC address of your Unraid server in the second line\ninstead of 'MAC'"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cd c:\\program files\\wolcmd\nwolcmd MAC 255.255.255.255 255.255.255.255\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Place the batch file on your desktop for easy access."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Copy of my batch file attached to ",(0,t.jsx)(n.a,{href:"https://forums.unraid.net/forum/index.php?topic=3657.msg39076#msg39076",children:"this Unraid forum\npost"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"6. Manually test sleep and WOL"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Spin-down drives (I'm not certain that this is required. I did\nforce sleep from the active state (spinning) once before and got a\nparity check on wake-up. I'll test some more.)"}),"\n",(0,t.jsxs)(n.li,{children:["Telnet to server and enter ",(0,t.jsx)(n.code,{children:"echo 3 >/proc/acpi/sleep"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ensure server sleeps"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Execute ",(0,t.jsx)(n.strong,{children:"Wakeup.bat"})," file","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ensure server wakes up"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Repeat / test until comfortable"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Note: Some people have reported that their system misbehaves on the\nsecond or later sleep, so you should test sleep and wake-up for a while\nand make sure everything is correct. In fact, I just noticed that waking\nup from S3 sleep, my system does not negotiate a gigabit connection and\nI go from 1000Mb/s to 100Mb/s after the initial sleep. So I have a\nlittle more work to do -- I'm guessing a Linux driver issue?"}),"\n",(0,t.jsx)(n.p,{children:"7. Record hard drive references (sda, sdb, etc)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["From Unraid 'Devices' page, make note of the hard drive references\nin your system. You're building a list of hard drives in the system\nfor use in the sleep script.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["I am currently only using two SATA drives, so my drive\nreferences are: ",(0,t.jsx)(n.strong,{children:"sda"})," and ",(0,t.jsx)(n.strong,{children:"sdb"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["8. Generate sleep script, or download mine from\n",(0,t.jsx)(n.a,{href:"https://forums.unraid.net/forum/index.php?topic=3657.msg39076#msg39076",children:"here"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["I copied OMV's sleep script verbatim from ",(0,t.jsx)(n.a,{href:"https://forums.unraid.net/forum/index.php?topic=3657",children:"this Unraid forum\nthread"}),", and\nthen edited the lines shown below in bold:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\ndrives="/dev/sda /dev/sdb"\ntimeout=5\ncount=5\nwhile [ 1 ]\ndo\n hdparm -C $drives | grep -q active\n if [ $? -eq 1 ]\n then\n  count=$[$count-1]\n else\n  count=$timeout\n fi\n if [ $count -le 0 ]\n then\n  # Do pre-sleep activities\n  sleep 5\n  # Go to sleep\n  echo 3 > /proc/acpi/sleep\n  # Do post-sleep activities\n  # Force NIC into gigabit mode\n  # (might be needed forgets about gigabit when it wakes up)\n  ethtool -s eth0 speed 1000\n  # Force a DHCP renewal (shouldn\'t be used for static-ip boxes)\n  /sbin/dhcpcd -n\n  sleep 5\n count=$timeout\nfi\n # Wait a minute\n echo COUNT $count\n sleep 60\ndone\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"timeout=5 and count=5 are programmable timers to set the delay from\nspin-down until sleep. This sets the delay to five minutes after\nspin down, OMV's original script was 15 minutes."}),"\n",(0,t.jsxs)(n.li,{children:["drives= line needs to be edited to reflect the drives that you want\nto be checked for status (idle or spinning). Again, my server only\nhas two drives (",(0,t.jsx)(n.strong,{children:"sda"})," and ",(0,t.jsx)(n.strong,{children:"sdb"}),"), so I edited accordingly. Be\naware that this drive list can change when upgrading Unraid or\nmodifying your hardware. It can even change from one boot to the\nnext. For example, your flash drive may be assigned ",(0,t.jsx)(n.strong,{children:"sdc"})," on one\nboot, but ",(0,t.jsx)(n.strong,{children:"sdd"})," on the next boot, with one of your hard drives\nassigned to ",(0,t.jsx)(n.strong,{children:"sdd"})," the first time, and ",(0,t.jsx)(n.strong,{children:"sdc"})," the next time."]}),"\n",(0,t.jsxs)(n.li,{children:["Copy of my ",(0,t.jsx)(n.strong,{children:"s3.sh"})," sleep script attached to ",(0,t.jsx)(n.a,{href:"https://forums.unraid.net/forum/index.php?topic=3657.msg39076#msg39076",children:"this Unraid forum\npost"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"9. Save script onto flash drive in specified location"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["I titled my sleep script ",(0,t.jsx)(n.strong,{children:"s3.sh"})," and saved in ",(0,t.jsx)(n.strong,{children:"/boot/custom/bin"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"IMPORTANT:"}),' "boot" is ',(0,t.jsx)(n.em,{children:"already"})," the name of the root directory of\nyour flash device. So, if you save your script as per this example, do\n",(0,t.jsx)(n.strong,{children:"not"}),' create another "boot" directory. Doing so will cause Unraid to\nlose track of your config directory and your entire configuration will\nbe lost (unless previously backed up elsewhere.)']}),"\n",(0,t.jsx)(n.p,{children:"10. Edit 'go' file to call script"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"I added the following lines to my go script to initiate the sleep\nscript during boot:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Execute s3.sh sleep script\nfromdos < /boot/custom/bin/s3.sh | at now + 1 minute\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Make sure you adjust file directory structure as necessary depending\nupon where you saved your ",(0,t.jsx)(n.strong,{children:"s3.sh"})," script."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"11. Re-boot / test"}),"\n",(0,t.jsx)(n.p,{children:"Good luck!"})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>o});var t=s(7294);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);